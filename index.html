<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petar's Smart Glove</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 50px; background-color: #1a1a1a; color: white; }
        .container { background: #2c2c2c; padding: 30px; border-radius: 15px; display: inline-block; }
        #povezi { padding: 15px 40px; font-size: 18px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 50px; }
        #status { margin-top: 25px; font-size: 1.2em; color: #bbb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Smart Glove Project</h1>
        <p>Future of Communication by Petar</p>
        <button id="povezi">Connect Glove</button>
        <div id="status">Status: Disconnected</div>
    </div>

    <script>
        const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
        const TX_CHARACTERISTIC_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';

        const dugme = document.getElementById('povezi');
        const statusPolje = document.getElementById('status');

        dugme.addEventListener('click', async () => {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [SERVICE_UUID]
                });
                const server = await device.gatt.connect();
                const service = await server.getPrimaryService(SERVICE_UUID);
                const characteristic = await service.getCharacteristic(TX_CHARACTERISTIC_UUID);
                await characteristic.startNotifications();
                
                statusPolje.innerText = "Status: CONNECTED âœ…";
                statusPolje.style.color = "#28a745";

                characteristic.addEventListener('characteristicvaluechanged', (event) => {
                    let decoder = new TextDecoder('utf-8');
                    let msg = decoder.decode(event.target.value).trim();
                    console.log("Stiglo:", msg);

                    if (!window.speechSynthesis.speaking) {
                        if (msg === "Hello") speak("Hello, I am your smart glove");
                        else if (msg === "Yes") speak("Yes, I agree");
                        else if (msg === "No") speak("No, thank you");
                        else if (msg === "Help") speak("I need help, please");
                        else if (msg === "Goodbye") speak("Goodbye, have a nice day");
                    }
                });
            } catch (error) {
                statusPolje.innerText = "Error: " + error.message;
            }
        });

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
